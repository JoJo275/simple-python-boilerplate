# Software Bill of Materials (SBOM)

This project generates SBOMs in two standard formats and distributes them through four complementary channels.

---

## Formats

| Format | Standard | Role | File pattern |
|--------|----------|------|-------------|
| **SPDX 2.3 JSON** | ISO/IEC 5962:2021 (Linux Foundation) | **Primary** | `sbom-spdx.json` |
| **CycloneDX 1.x JSON** | OWASP / Ecma International (ECMA-424) | Secondary | `sbom-cyclonedx.json` |

Both are generated by [Syft](https://github.com/anchore/syft) (via [`anchore/sbom-action`](https://github.com/anchore/sbom-action)).

---

## Distribution Channels

### Channel 1 ‚Äî GitHub Dependency Graph "Export SBOM"

- **What:** GitHub-computed SPDX JSON based on the repository's dependency graph.
- **Where:** Repository ‚Üí Insights ‚Üí Dependency graph ‚Üí Export SBOM.
- **Who controls it:** GitHub (automatic; no workflow needed).
- **Authoritative?** No ‚Äî computed independently by GitHub and may differ from channels 2‚Äì4.

### Channel 2 ‚Äî Actions Artifact (per workflow run)

- **What:** SPDX and CycloneDX JSON files uploaded as workflow artifacts on every push, PR, and weekly schedule.
- **Where:** Actions ‚Üí workflow run ‚Üí Artifacts section (`sbom-spdx`, `sbom-cyclonedx`).
- **Who controls it:** [`sbom.yml`](../.github/workflows/sbom.yml) workflow.
- **Authoritative?** No ‚Äî these are point-in-time snapshots per commit.

### Channel 3 ‚Äî Release Asset (attached to a tag/release) üèÜ

- **What:** SPDX and CycloneDX JSON files attached to the GitHub Release.
- **Where:** Repository ‚Üí Releases ‚Üí select a version ‚Üí Assets.
- **Who controls it:** [`release.yml`](../.github/workflows/release.yml) workflow (sbom job).
- **Authoritative?** **Yes ‚Äî the release-asset SBOM is authoritative for each tagged version.**

This is the SBOM that consumers, auditors, and procurement teams should reference when evaluating a specific release.

### Channel 4 ‚Äî Dependency Submission API (Dependency Graph enrichment)

- **What:** Dependency data submitted to GitHub so the repository's Dependency Graph and Dependabot alerts reflect the full installed dependency tree (including transitive dependencies).
- **Where:** Repository ‚Üí Insights ‚Üí Dependency graph (enriched view); Security ‚Üí Dependabot alerts.
- **Who controls it:** [`sbom.yml`](../.github/workflows/sbom.yml) workflow (push to `main` only).
- **Authoritative?** No ‚Äî enriches the GitHub UI/alerts but is not a downloadable artifact.

---

## Which SBOM Should I Use?

| Use case | Recommended channel |
|----------|-------------------|
| Evaluating a specific release | **Channel 3** ‚Äî Release asset |
| Latest CI snapshot for development | Channel 2 ‚Äî Actions artifact |
| Quick export without cloning | Channel 1 ‚Äî GitHub Dependency Graph |
| Monitoring for new vulnerabilities | Channel 4 ‚Äî Dependency Submission (feeds Dependabot) |

---

## Important: Outputs May Differ

The four channels may produce different results because they use different scanners and resolve dependencies differently:

| Channel | Scanner | Scope |
|---------|---------|-------|
| 1 (GitHub export) | GitHub's dependency resolver | Declared dependencies in manifest files |
| 2 & 3 (Syft) | Anchore Syft | Installed Python environment + file-system detection |
| 4 (Submission API) | Anchore Syft (submitted data) | Same as 2 & 3, surfaced in GitHub's UI |

In particular:
- **Channel 1** resolves from `pyproject.toml` / `requirements.txt` without installing.
- **Channels 2‚Äì4** install the project (`pip install -e .`) and scan the resulting environment, so they include **transitive dependencies** that channel 1 may miss.

If discrepancies arise, the **release-asset SBOM (channel 3)** is the authoritative reference.

---

## Workflow Details

### `sbom.yml` ‚Äî CI SBOM generation

| Setting | Value |
|---------|-------|
| Triggers | push to `main`, PRs, weekly (Monday 13:00 UTC), manual |
| Repository guard | `vars.ENABLE_SBOM = 'true'` |
| Artifacts | `sbom-spdx` (SPDX JSON), `sbom-cyclonedx` (CycloneDX JSON) |
| Dependency Submission | Push to `main` only |

### `release.yml` ‚Äî Release SBOM generation

| Setting | Value |
|---------|-------|
| Triggers | Tag push (`v*.*.*`), manual |
| Repository guard | Same as the existing release guard (`vars.ENABLE_RELEASE`) |
| Release assets | `sbom-spdx.json`, `sbom-cyclonedx.json` alongside dist artifacts |

---

## Enabling SBOMs

### For the CI workflow (`sbom.yml`)

Set a repository variable:

```
Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí Variables
  Name:  ENABLE_SBOM
  Value: true
```

Or replace `YOURNAME/YOURREPO` in the workflow file with your repo slug.

### For release SBOMs (`release.yml`)

No additional setup needed ‚Äî the SBOM job inherits the existing release repository guard (`vars.ENABLE_RELEASE`).

---

## See Also

- [ADR-013](adr/013-sbom-bill-of-materials.md) ‚Äî Decision record for the SBOM strategy
- [Workflows](workflows.md) ‚Äî All GitHub Actions workflows
- [ADR-012](adr/012-multi-layer-security-scanning.md) ‚Äî Multi-layer security scanning
- [SPDX Specification](https://spdx.github.io/spdx-spec/v2.3/)
- [CycloneDX Specification](https://cyclonedx.org/specification/overview/)
- [NTIA Minimum Elements for an SBOM](https://www.ntia.gov/sites/default/files/publications/sbom_minimum_elements_report_0.pdf)
