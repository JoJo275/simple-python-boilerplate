# ──────────────────────────────────────────────────────────────
# Type Check Workflow
# ──────────────────────────────────────────────────────────────
# Runs mypy in strict mode against the src/ package to enforce
# type annotations and catch type errors at CI time.
#
# Triggers:
#   - Push to main
#   - Pull requests targeting main
#   - Manual dispatch via the GitHub Actions UI
#
# Configuration lives in pyproject.toml under [tool.mypy].
# ──────────────────────────────────────────────────────────────

name: Type check

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  type-check:
    name: mypy (strict)
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # Checkout a Git repository at a particular version (v6.0.2)
        with:
          persist-credentials: false

      - name: Set up Python
        uses: actions/setup-python@a309ff8b426b58ec0e2a45f0f869d46889d02405 # Set up a specific version of Python and add… (v6.2.0)
        with:
          python-version: "3.12"
          cache: "pip"

      # Install the package in editable mode so mypy can resolve
      # imports from the src/ layout, then install mypy itself.
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .
          python -m pip install mypy

      # Runs mypy against the src/ package. Configuration
      # (strict mode, overrides, etc.) is read from pyproject.toml.
      - name: Run mypy
        run: mypy src/
